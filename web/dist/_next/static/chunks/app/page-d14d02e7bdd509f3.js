(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3585:function(e,t,o){Promise.resolve().then(o.bind(o,5551))},5551:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return ea}});var n=o(7437),i=o(2265),r=o(5149),l=o(5392),d=o(5554);let a={50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},s={50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},c={25:"#f0f9ff",50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},u={50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d"},p={50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7c3aed",800:"#6b21a8",900:"#581c87"},g={50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d"},f="#ffffff",x="0.25rem",b="0.5rem",h="1rem",m="1.5rem",v="0.75rem",y="0.875rem",C="1.125rem",S="0.125rem",k="0.375rem",I="0.5rem",j={container:{position:"relative"},draggableArea:{padding:h,borderBottom:"1px solid ".concat(s[200]),cursor:"grab"},draggableAreaActive:{cursor:"grabbing"},titleForm:{flex:1},titleInput:{width:"100%",margin:0,padding:b,border:"1px solid ".concat(s[300]),borderRadius:S,fontSize:y,backgroundColor:"#ffffff"},title:{paddingLeft:"8px",cursor:"pointer",fontSize:y,fontWeight:"600",color:s[900],margin:0},buttonsContainer:{position:"absolute",top:"12px",right:"12px",display:"flex",alignItems:"center",gap:"8px",zIndex:10,pointerEvents:"auto"},nodeCount:{fontSize:"0.75rem",color:"#6b7280",backgroundColor:"#f3f4f6",padding:"2px 6px",borderRadius:"4px"},settingsButton:{backgroundColor:"transparent",border:"none",color:s[400],cursor:"pointer",padding:x,borderRadius:S,transition:"all 0.2s ease",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},settingsButtonHover:{backgroundColor:s[100],color:s[700]},collapseButton:{background:"none",border:"none",cursor:"pointer",fontSize:"14px",color:"#6b7280",padding:"4px"},deleteButton:{backgroundColor:"transparent",border:"none",color:s[400],cursor:"pointer",padding:x,borderRadius:S,transition:"all 0.2s ease"},deleteButtonHover:{backgroundColor:s[100],color:s[700]},deleteButtonDisabled:{opacity:.5,cursor:"not-allowed"}},E=[{id:"activities",name:"Activities",color:"#3b82f6",order:0,type:"fixed"},{id:"outputs",name:"Outputs",color:"#10b981",order:1,type:"fixed"},{id:"intermediate-1",name:"Intermediate Outcomes 1",color:"#f59e0b",order:2,type:"intermediate"},{id:"final-outcomes",name:"Final Outcomes",color:"#ef4444",order:3,type:"fixed"},{id:"impact",name:"Impact",color:"#8b5cf6",order:4,type:"fixed"}],w="intermediate",D={ACTIVITY:"activity",OUTPUT:"output",INTERMEDIATE_OUTCOME:"intermediate_outcome",FINAL_OUTCOME:"final_outcome",IMPACT:"impact"},T={LEADS_TO:"leads_to",ENABLES:"enables",REQUIRES:"requires",CONTRIBUTES_TO:"contributes_to"},M={[T.LEADS_TO]:{stroke:"#1355bfff",strokeWidth:2,style:"solid",label:"leads to"},[T.ENABLES]:{stroke:"#10b981",strokeWidth:2,style:"dashed",label:"enables"},[T.REQUIRES]:{stroke:"#ef4444",strokeWidth:2,style:"dotted",label:"requires"},[T.CONTRIBUTES_TO]:{stroke:"#f59e0b",strokeWidth:2,style:"solid",label:"contributes to"}};function L(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.ACTIVITY;return{id:O(),title:e,description:"",listId:t,type:o,tags:[],color:"",priority:"medium",order:0,position:{x:0,y:0},size:{width:200,height:100},collapsed:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}function B(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.LEADS_TO;return{id:O(),sourceId:e,targetId:t,type:o,label:M[o].label,style:M[o],animated:!1,createdAt:new Date().toISOString()}}function O(){return Math.random().toString(36).substr(2,9)}function A(e){let{list:t,nodesCount:o,isEditingTitle:i,editTitle:r,setIsEditingTitle:l,setEditTitle:d,handleTitleEdit:a,hoveredButton:s,setHoveredButton:c,listeners:u,attributes:p,onSettingsClick:g,onDeleteList:f,isDragging:x}=e;return(0,n.jsxs)("div",{style:j.container,children:[(0,n.jsx)("div",{style:{...j.draggableArea,...x?j.draggableAreaActive:{}},...u,...p,children:i?(0,n.jsx)("form",{onSubmit:a,style:j.titleForm,children:(0,n.jsx)("input",{type:"text",value:r,onChange:e=>d(e.target.value),onBlur:a,autoFocus:!0,style:j.titleInput})}):(0,n.jsx)("h3",{style:{...j.title,borderLeft:"4px solid ".concat(t.color||"#3b82f6")},onClick:()=>l(!0),children:t.name})}),(0,n.jsxs)("div",{style:j.buttonsContainer,children:[(0,n.jsx)("span",{style:j.nodeCount,children:o}),(0,n.jsx)("button",{style:{...j.settingsButton,..."settings"===s?j.settingsButtonHover:{}},onClick:e=>{e.stopPropagation(),e.preventDefault(),g(e)},onMouseEnter:()=>c("settings"),onMouseLeave:()=>c(null),title:"List settings",children:"⚙️"}),"fixed"!==t.type?(0,n.jsx)("button",{style:{...j.deleteButton,..."delete"===s?j.deleteButtonHover:{}},onClick:()=>{confirm('Delete "'.concat(t.name,'" and all its nodes?'))&&f(t.id)},onMouseEnter:()=>c("delete"),onMouseLeave:()=>c(null),title:"Delete list",children:"✕"}):null]})]})}let N={container:{backgroundColor:f,borderRadius:k,boxShadow:"0 1px 2px 0 rgb(0 0 0 / 0.05)",border:"1px solid",borderColor:s[200],margin:x,cursor:"pointer",transition:"all 0.2s ease",position:"relative",minHeight:"80px",padding:b},containerHover:{boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)",borderColor:c[300],transform:"translateY(-1px)"},containerLinkMode:{borderColor:p[400],backgroundColor:p[50],cursor:"crosshair"},containerLinkModeHover:{borderColor:p[500],backgroundColor:p[100],transform:"scale(1.02)"},containerLinkSource:{borderColor:u[500],backgroundColor:u[50],boxShadow:"0 0 0 2px ".concat(u[200])},containerConnected:{borderColor:c[400],backgroundColor:c[25]},header:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:x},icon:{fontSize:C,marginRight:x,color:s[600]},priority:{fontSize:v,fontWeight:"600",color:s[500],backgroundColor:s[100],padding:"".concat(x," ").concat(b),borderRadius:S,minWidth:"20px",textAlign:"center"},actions:{display:"flex",gap:x,opacity:0,transition:"opacity 0.2s ease"},actionButton:{backgroundColor:"none",border:"none",cursor:"pointer",padding:x,borderRadius:S,color:s[500],fontSize:y,opacity:0,transition:"all 0.2s ease"},actionButtonVisible:{opacity:1},actionButtonHover:{backgroundColor:s[100],color:s[700]},content:{fontSize:y,lineHeight:"1.75"},editForm:{display:"flex",flexDirection:"column",gap:b},input:{border:"1px solid ".concat(s[300]),borderRadius:S,padding:b,fontSize:y,outline:"none",transition:"border-color 0.2s ease"},inputFocus:{borderColor:c[500],boxShadow:"0 0 0 2px ".concat(c[100])},title:{fontWeight:"500",color:s[900],marginBottom:x},description:{color:s[600],fontSize:v,lineHeight:"1.5"},buttonGroup:{display:"flex",gap:x,marginTop:b},button:{padding:"".concat(x," ").concat(b),borderRadius:S,border:"none",cursor:"pointer",fontSize:v,fontWeight:"500",transition:"all 0.2s ease"},buttonPrimary:{backgroundColor:c[600],color:f},buttonPrimaryHover:{backgroundColor:c[700]},buttonSecondary:{backgroundColor:s[200],color:s[700]},buttonSecondaryHover:{backgroundColor:s[300]},details:{marginTop:b,padding:b,backgroundColor:s[50],borderRadius:S,fontSize:v},meta:{display:"flex",flexDirection:"column",gap:x},metaItem:{color:s[600],fontSize:v},editActions:{display:"flex",gap:x,marginTop:b,justifyContent:"flex-end"},contextMenu:{position:"fixed",backgroundColor:f,border:"1px solid ".concat(s[200]),borderRadius:k,boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)",padding:x,zIndex:1e3,minWidth:"150px"},contextMenuItem:{display:"block",width:"100%",padding:b,border:"none",backgroundColor:"transparent",textAlign:"left",cursor:"pointer",fontSize:y,color:s[700],borderRadius:S,transition:"background-color 0.2s ease"},contextMenuItemHover:{backgroundColor:s[100]},contextMenuItemDanger:{color:g[600]},contextMenuItemDangerHover:{backgroundColor:g[50],color:g[700]},draggableIndicator:{position:"absolute",top:"-2px",left:"-2px",right:"-2px",bottom:"-2px",border:"2px dashed ".concat(c[400]),borderRadius:k,pointerEvents:"none"}},z={container:{backgroundColor:"#ffffff",borderBottom:"1px solid ".concat(s[200]),padding:h,display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},title:{fontSize:"1.25rem",fontWeight:"bold",color:s[900],margin:0},actions:{display:"flex",gap:b},button:{backgroundColor:a[500],color:"#ffffff",border:"none",padding:"".concat(b," ").concat(h),borderRadius:k,cursor:"pointer",fontSize:y,fontWeight:"500",transition:"all 0.2s ease"},buttonHover:{backgroundColor:a[600]},buttonSecondary:{backgroundColor:s[500]},buttonSecondaryHover:{backgroundColor:s[600]},buttonDanger:{backgroundColor:"#ef4444"},buttonDangerHover:{backgroundColor:"#dc2626"},section:{display:"flex",alignItems:"center",gap:"12px"},separator:{width:"1px",height:"24px",backgroundColor:"#e5e7eb",margin:"0 12px"},statusText:{fontSize:"14px",color:"#6b7280",fontWeight:"500"},counter:{fontSize:"12px",backgroundColor:"#3b82f6",color:"white",padding:"2px 8px",borderRadius:"12px",fontWeight:"600"}};function R(e){let{editTitle:t,setEditTitle:o,editDescription:i,setEditDescription:r,onSubmit:l,onCancel:d,hoveredButton:a,setHoveredButton:s}=e;return(0,n.jsxs)("form",{onSubmit:l,style:N.editForm,children:[(0,n.jsx)("input",{type:"text",value:t,onChange:e=>o(e.target.value),placeholder:"Node title",autoFocus:!0,style:{...N.input,..."titleInput"===a?N.inputFocus:{}},onFocus:()=>s("titleInput"),onBlur:()=>s(null)}),(0,n.jsx)("textarea",{value:i,onChange:e=>r(e.target.value),placeholder:"Description (optional)",rows:"3",style:{...N.input,resize:"vertical",..."descInput"===a?N.inputFocus:{}},onFocus:()=>s("descInput"),onBlur:()=>s(null)}),(0,n.jsxs)("div",{style:N.editActions,children:[(0,n.jsx)("button",{type:"submit",style:{...z.button,...z.buttonPrimary,fontSize:"0.75rem",padding:"0.25rem 0.5rem",..."save"===a?z.buttonPrimaryHover:{}},onMouseEnter:()=>s("save"),onMouseLeave:()=>s(null),children:"Save"}),(0,n.jsx)("button",{type:"button",onClick:d,style:{...z.button,...z.buttonSecondary,fontSize:"0.75rem",padding:"0.25rem 0.5rem",..."cancel"===a?z.buttonSecondaryHover:{}},onMouseEnter:()=>s("cancel"),onMouseLeave:()=>s(null),children:"Cancel"})]})]})}function H(e){let{tags:t}=e;return t&&0!==t.length?(0,n.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem",marginBottom:"0.5rem"},children:t.map((e,t)=>(0,n.jsx)("span",{style:{fontSize:"0.75rem",backgroundColor:"#f3f4f6",color:"#374151",padding:"0.125rem 0.375rem",borderRadius:"0.25rem"},children:e},t))}):null}function W(e){let{node:t,showDetails:o,setShowDetails:i,onEdit:r,onDuplicate:l,onDelete:d,onShowConnectionDetails:a,connectedNodes:s,linkMode:c,isLinkSource:u,hoveredButton:p,setHoveredButton:g}=e;return s&&s.length,(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{style:{...N.title,...c&&u?N.linkSourceTitle:{}},children:t.title}),t.description&&(0,n.jsxs)("div",{style:N.description,children:[o?(0,n.jsx)("div",{children:t.description}):(0,n.jsx)("div",{children:t.description.length>100?"".concat(t.description.substring(0,100),"..."):t.description}),t.description.length>100&&(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),i(!o)},style:{...z.button,...z.buttonSecondary,fontSize:"0.7rem",padding:"0.125rem 0.25rem",marginTop:"0.25rem",..."details"===p?z.buttonSecondaryHover:{}},onMouseEnter:()=>g("details"),onMouseLeave:()=>g(null),children:o?"Show Less":"Show More"})]}),(0,n.jsx)(H,{tags:t.tags})]})}function P(e){let{show:t,position:o,onClose:i,onMoveNode:r,onStartLinking:l,onEdit:d,onDuplicate:a,onShowCausalPath:s,onDelete:c,hoveredButton:u,setHoveredButton:p}=e;return t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:999},onClick:i}),(0,n.jsxs)("div",{style:{...N.contextMenu,top:o.y,left:o.x},children:[(0,n.jsx)("button",{style:{...N.contextMenuItem,..."move"===u?N.contextMenuItemHover:{}},onClick:r,onMouseEnter:()=>p("move"),onMouseLeave:()=>p(null),children:"\uD83D\uDD04 Move Node"}),(0,n.jsx)("button",{style:{...N.contextMenuItem,..."link"===u?N.contextMenuItemHover:{}},onClick:l,onMouseEnter:()=>p("link"),onMouseLeave:()=>p(null),children:"\uD83D\uDD17 Draw Arrow"}),(0,n.jsx)("button",{style:{...N.contextMenuItem,..."edit-ctx"===u?N.contextMenuItemHover:{}},onClick:d,onMouseEnter:()=>p("edit-ctx"),onMouseLeave:()=>p(null),children:"✏️ Edit"}),(0,n.jsx)("button",{style:{...N.contextMenuItem,..."duplicate-ctx"===u?N.contextMenuItemHover:{}},onClick:a,onMouseEnter:()=>p("duplicate-ctx"),onMouseLeave:()=>p(null),children:"\uD83D\uDCCB Duplicate"}),(0,n.jsx)("button",{style:{...N.contextMenuItem,..."causalpath-ctx"===u?N.contextMenuItemHover:{}},onClick:s,onMouseEnter:()=>p("causalpath-ctx"),onMouseLeave:()=>p(null),children:"\uD83D\uDD17 Show Causal Path"}),(0,n.jsx)("button",{style:{...N.contextMenuItem,...N.contextMenuItemDanger,..."delete-ctx"===u?N.contextMenuItemDangerHover:{}},onClick:c,onMouseEnter:()=>p("delete-ctx"),onMouseLeave:()=>p(null),children:"\uD83D\uDDD1️ Delete"})]})]}):null}var U=o(4170);function _(e){let{isOpen:t,onClose:o,onSave:r,node:l,allNodes:d,board:a,onAddEdge:s,onDeleteEdge:c}=e,[u,p]=(0,i.useState)({title:"",description:"",tags:[]}),[g,f]=(0,i.useState)([]),[x,b]=(0,i.useState)([]),[h,m]=(0,i.useState)(""),[v,y]=(0,i.useState)(""),[C,S]=(0,i.useState)(""),[k,I]=(0,i.useState)(!1),[j,E]=(0,i.useState)(!1),w=(0,i.useRef)(null),D=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(t&&l){p({title:l.title||"",description:l.description||"",tags:[...l.tags||[]]});let e=(null==a?void 0:a.edges)||[],t=e.filter(e=>e.targetId===l.id).map(e=>d.find(t=>t.id===e.sourceId)).filter(Boolean),o=e.filter(e=>e.sourceId===l.id).map(e=>d.find(t=>t.id===e.targetId)).filter(Boolean);f(t),b(o),y(""),S("")}},[t,l,d,null==a?void 0:a.edges]);let T=()=>{if(!d||!l)return[];let e=g.map(e=>e.id);return d.filter(t=>t.id!==l.id&&!e.includes(t.id)&&t.title.toLowerCase().includes(v.toLowerCase()))},M=()=>{if(!d||!l)return[];let e=x.map(e=>e.id);return d.filter(t=>t.id!==l.id&&!e.includes(t.id)&&t.title.toLowerCase().includes(C.toLowerCase()))},L=(e,t)=>{p(o=>({...o,[e]:t}))},B=()=>{h.trim()&&!u.tags.includes(h.trim())&&(p(e=>({...e,tags:[...e.tags,h.trim()]})),m(""))},O=e=>{p(t=>({...t,tags:t.tags.filter(t=>t!==e)}))},A=e=>{f(t=>[...t,e]),y(""),I(!1)},N=e=>{f(t=>t.filter(t=>t.id!==e.id))},z=e=>{b(t=>[...t,e]),S(""),E(!1)},R=e=>{b(t=>t.filter(t=>t.id!==e.id))},H=(e,t)=>{"Enter"===e.key&&(e.preventDefault(),t())};if((0,i.useEffect)(()=>{let e=e=>{w.current&&!w.current.contains(e.target)&&I(!1),D.current&&!D.current.contains(e.target)&&E(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),!l)return null;let W={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},dialog:{backgroundColor:"white",borderRadius:"0.5rem",padding:"1.5rem",maxWidth:"600px",width:"90%",maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)"},title:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem",color:"#1f2937"},section:{marginBottom:"1.5rem"},label:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem",color:"#374151"},input:{width:"100%",padding:"0.5rem",border:"1px solid #d1d5db",borderRadius:"0.25rem",fontSize:"0.875rem",outline:"none",transition:"border-color 0.2s",boxSizing:"border-box"},textarea:{width:"100%",padding:"0.5rem",border:"1px solid #d1d5db",borderRadius:"0.25rem",fontSize:"0.875rem",outline:"none",transition:"border-color 0.2s",resize:"vertical",minHeight:"80px",boxSizing:"border-box"},multiSelectContainer:{position:"relative",width:"100%"},selectedItems:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginBottom:"0.5rem"},selectedItem:{backgroundColor:"#eff6ff",color:"#1d4ed8",padding:"0.25rem 0.5rem",borderRadius:"0.25rem",fontSize:"0.75rem",display:"flex",alignItems:"center",gap:"0.25rem"},removeButton:{background:"none",border:"none",color:"#1d4ed8",cursor:"pointer",fontSize:"0.875rem",padding:"0",lineHeight:"1"},dropdown:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"0.25rem",maxHeight:"200px",overflow:"auto",zIndex:10,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},dropdownItem:{padding:"0.5rem",cursor:"pointer",fontSize:"0.875rem",borderBottom:"1px solid #f3f4f6"},dropdownItemHover:{backgroundColor:"#f3f4f6"},tagContainer:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginBottom:"0.5rem"},tag:{backgroundColor:"#f3f4f6",color:"#374151",padding:"0.25rem 0.5rem",borderRadius:"0.25rem",fontSize:"0.75rem",display:"flex",alignItems:"center",gap:"0.25rem"},tagInput:{display:"flex",gap:"0.5rem",alignItems:"center"},addButton:{backgroundColor:"#3b82f6",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"0.25rem",cursor:"pointer",fontSize:"0.75rem",whiteSpace:"nowrap"},actions:{display:"flex",gap:"0.75rem",justifyContent:"flex-end",marginTop:"2rem"},button:{padding:"0.5rem 1rem",borderRadius:"0.25rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",border:"none",transition:"all 0.2s"},saveButton:{backgroundColor:"#3b82f6",color:"white"},cancelButton:{backgroundColor:"#f3f4f6",color:"#374151"}};return(0,n.jsx)(U.Vq,{open:t,onClose:o,children:(0,n.jsx)("div",{style:W.overlay,children:(0,n.jsxs)(U.Vq.Panel,{style:W.dialog,children:[(0,n.jsx)(U.Vq.Title,{style:W.title,children:"Edit Node"}),(0,n.jsxs)("div",{style:W.section,children:[(0,n.jsx)("label",{style:W.label,children:"Name"}),(0,n.jsx)("input",{type:"text",value:u.title,onChange:e=>L("title",e.target.value),style:W.input,placeholder:"Enter node name"})]}),(0,n.jsxs)("div",{style:W.section,children:[(0,n.jsx)("label",{style:W.label,children:"Description"}),(0,n.jsx)("textarea",{value:u.description,onChange:e=>L("description",e.target.value),style:W.textarea,placeholder:"Enter node description"})]}),(0,n.jsxs)("div",{style:W.section,children:[(0,n.jsx)("label",{style:W.label,children:"Upstream Nodes"}),(0,n.jsxs)("div",{style:W.multiSelectContainer,ref:w,children:[(0,n.jsx)("div",{style:W.selectedItems,children:g.map(e=>(0,n.jsxs)("div",{style:W.selectedItem,children:[e.title,(0,n.jsx)("button",{style:W.removeButton,onClick:()=>N(e),children:"\xd7"})]},e.id))}),(0,n.jsx)("input",{type:"text",value:v,onChange:e=>{y(e.target.value),I(!0)},onFocus:()=>I(!0),style:W.input,placeholder:"Search and select upstream nodes..."}),k&&(0,n.jsx)("div",{style:W.dropdown,children:0===T().length?(0,n.jsx)("div",{style:W.dropdownItem,children:v?"No matching nodes found":"No available nodes"}):T().map(e=>(0,n.jsx)("div",{style:W.dropdownItem,onClick:()=>A(e),onMouseEnter:e=>e.target.style.backgroundColor=W.dropdownItemHover.backgroundColor,onMouseLeave:e=>e.target.style.backgroundColor="white",children:e.title},e.id))})]})]}),(0,n.jsxs)("div",{style:W.section,children:[(0,n.jsx)("label",{style:W.label,children:"Downstream Nodes"}),(0,n.jsxs)("div",{style:W.multiSelectContainer,ref:D,children:[(0,n.jsx)("div",{style:W.selectedItems,children:x.map(e=>(0,n.jsxs)("div",{style:W.selectedItem,children:[e.title,(0,n.jsx)("button",{style:W.removeButton,onClick:()=>R(e),children:"\xd7"})]},e.id))}),(0,n.jsx)("input",{type:"text",value:C,onChange:e=>{S(e.target.value),E(!0)},onFocus:()=>E(!0),style:W.input,placeholder:"Search and select downstream nodes..."}),j&&(0,n.jsx)("div",{style:W.dropdown,children:0===M().length?(0,n.jsx)("div",{style:W.dropdownItem,children:C?"No matching nodes found":"No available nodes"}):M().map(e=>(0,n.jsx)("div",{style:W.dropdownItem,onClick:()=>z(e),onMouseEnter:e=>e.target.style.backgroundColor=W.dropdownItemHover.backgroundColor,onMouseLeave:e=>e.target.style.backgroundColor="white",children:e.title},e.id))})]})]}),(0,n.jsxs)("div",{style:W.section,children:[(0,n.jsx)("label",{style:W.label,children:"Tags"}),(0,n.jsx)("div",{style:W.tagContainer,children:u.tags.map(e=>(0,n.jsxs)("div",{style:W.tag,children:[e,(0,n.jsx)("button",{style:W.removeButton,onClick:()=>O(e),children:"\xd7"})]},e))}),(0,n.jsxs)("div",{style:W.tagInput,children:[(0,n.jsx)("input",{type:"text",value:h,onChange:e=>m(e.target.value),onKeyPress:e=>H(e,B),style:{...W.input,flex:1},placeholder:"Add a tag..."}),(0,n.jsx)("button",{style:W.addButton,onClick:B,disabled:!h.trim(),children:"Add"})]})]}),(0,n.jsxs)("div",{style:W.actions,children:[(0,n.jsx)("button",{style:{...W.button,...W.cancelButton},onClick:o,children:"Cancel"}),(0,n.jsx)("button",{style:{...W.button,...W.saveButton},onClick:()=>{if(!l)return;r(l.id,u);let e=(null==a?void 0:a.edges)||[],t=e.filter(e=>e.targetId===l.id).map(e=>e.sourceId),n=e.filter(e=>e.sourceId===l.id).map(e=>e.targetId),i=g.map(e=>e.id),d=x.map(e=>e.id);t.forEach(t=>{if(!i.includes(t)){let o=e.find(e=>e.sourceId===t&&e.targetId===l.id);o&&c&&c(o.id)}}),n.forEach(t=>{if(!d.includes(t)){let o=e.find(e=>e.sourceId===l.id&&e.targetId===t);o&&c&&c(o.id)}}),i.forEach(e=>{!t.includes(e)&&s&&s(e,l.id)}),d.forEach(e=>{!n.includes(e)&&s&&s(l.id,e)}),o()},children:"Save Changes"})]})]})})})}function F(e){let t,{node:o,isDragging:r=!1,onUpdate:a=()=>{},onDelete:s=()=>{},onDuplicate:c=()=>{},onClick:u=()=>{},linkMode:p,isLinkSource:g,connectedNodes:f=[],isDraggable:x=!1,onToggleDraggable:b,onStartLinking:h,onShowCausalPath:m,causalPathMode:v=!1,isInCausalPath:y=!1,allNodes:C=[],board:S={},onAddEdge:k=()=>{},onDeleteEdge:I=()=>{}}=e,[j,E]=(0,i.useState)(null),[w,D]=(0,i.useState)(!1),[T,M]=(0,i.useState)(o.title),[L,B]=(0,i.useState)(o.description),[O,A]=(0,i.useState)(!1),[z,H]=(0,i.useState)(!1),[U,F]=(0,i.useState)(!1),[Y,V]=(0,i.useState)({x:0,y:0}),[q,X]=(0,i.useState)(!1);(0,i.useEffect)(()=>{console.log("Node props changed:",{node:o,isDraggable:x,linkMode:p})},[o,x,p]);let{attributes:Q,listeners:G,setNodeRef:K,transform:$,transition:J,isDragging:Z}=(0,l.nB)({id:o.id,data:{type:"node",nodeId:o.id,listId:o.listId},disabled:!x}),ee={transform:d.ux.Transform.toString($),transition:J,opacity:r||Z?.8:1},et=e=>{e.stopPropagation(),p?u(o.id):(V({x:e.clientX,y:e.clientY}),F(!0))},eo=f.length>0;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{ref:K,style:(t={...ee,...N.container,cursor:x?"grab":"pointer"},z&&(t={...t,...N.containerHover}),p&&(t={...t,...N.containerLinkMode},z&&(t={...t,...N.containerLinkModeHover})),g&&(t={...t,...N.containerLinkSource}),eo&&(t={...t,...N.containerConnected}),v&&y&&(t={...t,border:"3px solid #f59e0b",boxShadow:"0 0 12px rgba(245, 158, 11, 0.4)",backgroundColor:"rgba(245, 158, 11, 0.1)"}),t),onClick:et,onContextMenu:et,onDoubleClick:e=>{e.stopPropagation(),p||D(!0)},onMouseEnter:()=>H(!0),onMouseLeave:()=>H(!1),"data-node-id":o.id,...Q,...x?G:{},children:[x&&(0,n.jsx)("div",{style:N.draggableIndicator}),(0,n.jsx)("div",{style:N.content,children:w?(0,n.jsx)(R,{editTitle:T,setEditTitle:M,editDescription:L,setEditDescription:B,onSubmit:e=>{e.preventDefault(),T.trim()&&(a(o.id,{title:T,description:L}),D(!1))},onCancel:()=>{M(o.title),B(o.description),D(!1)},hoveredButton:j,setHoveredButton:E}):(0,n.jsx)(W,{node:o,showDetails:O,setShowDetails:A,onEdit:()=>D(!0),onDuplicate:c,onDelete:s,onShowConnectionDetails:()=>A(!O),connectedNodes:f||[],linkMode:p,isLinkSource:g,hoveredButton:j,setHoveredButton:E})}),p&&(0,n.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(16, 185, 129, 0.1)",border:"2px dashed ".concat(g?"orange":"#10b981"),borderRadius:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"600",color:"#065f46",pointerEvents:"none"}})]}),(0,n.jsx)(P,{show:U,position:Y,onClose:()=>{F(!1)},onMoveNode:()=>{F(!1),b&&b(o.id,!0)},onStartLinking:()=>{F(!1),h&&h(o.id)},onEdit:()=>{F(!1),X(!0)},onDuplicate:()=>{F(!1),c(o.id)},onShowCausalPath:()=>{F(!1),m(o.id)},onDelete:()=>{F(!1),confirm("Delete this node?")&&s(o.id)},hoveredButton:j,setHoveredButton:E}),(0,n.jsx)(_,{isOpen:q,onClose:()=>X(!1),onSave:a,node:o,allNodes:C,board:S,onAddEdge:k,onDeleteEdge:I})]})}let Y={container:{flex:1,padding:h,display:"flex",flexDirection:"column",gap:b},nodesContainer:{display:"flex",flexDirection:"column",gap:"12px"},footer:{padding:h,borderTop:"1px solid ".concat(s[200])},addNodeForm:{backgroundColor:"#ffffff",border:"1px solid ".concat(s[200]),borderRadius:k,padding:h,display:"flex",flexDirection:"column",gap:b},addNodeInput:{width:"100%",padding:b,border:"1px solid ".concat(s[300]),borderRadius:S,fontSize:y,backgroundColor:"#ffffff"},addNodeActions:{display:"flex",gap:b},addButton:{backgroundColor:a[500],color:"#ffffff",border:"none",padding:"".concat(b," ").concat(h),borderRadius:k,cursor:"pointer",fontSize:y,fontWeight:"500",transition:"all 0.2s ease"},addButtonHover:{backgroundColor:a[600]},cancelButton:{backgroundColor:s[500],color:"#ffffff",border:"none",padding:"".concat(b," ").concat(h),borderRadius:k,cursor:"pointer",fontSize:y,fontWeight:"500",transition:"all 0.2s ease"},cancelButtonHover:{backgroundColor:s[600]},addNodeButton:{width:"100%",backgroundColor:s[50],border:"2px dashed ".concat(s[300]),color:s[500],padding:h,borderRadius:k,cursor:"pointer",transition:"all 0.2s ease",fontWeight:"500"},addNodeButtonHover:{backgroundColor:s[100],color:s[700]}};function V(e){let{nodes:t,isAddingNode:o,setIsAddingNode:i,newNodeTitle:r,setNewNodeTitle:d,handleAddNode:a,hoveredButton:s,setHoveredButton:c,onUpdateNode:u,onDeleteNode:p,onDuplicateNode:g,onNodeClick:f,linkMode:x,linkSource:b,getConnectedNodes:h,draggableNodes:m,onToggleNodeDraggable:v,onStartLinking:y,onShowCausalPath:C,causalPathMode:S,causalPathNodes:k,allNodes:I,board:j,onAddEdge:E,onDeleteEdge:w}=e;return(0,n.jsxs)("div",{style:Y.container,children:[(0,n.jsx)(l.Fo,{items:t.map(e=>e.id),strategy:l.qw,children:(0,n.jsx)("div",{style:Y.nodesContainer,children:t.map(e=>(0,n.jsx)(F,{node:e,onUpdate:u,onDelete:p,onDuplicate:g,onClick:f,linkMode:x,isLinkSource:b===e.id,connectedNodes:h(e.id),isDraggable:(null==m?void 0:m.has(e.id))||!1,onToggleDraggable:v,onStartLinking:y,onShowCausalPath:C,causalPathMode:S,isInCausalPath:(null==k?void 0:k.has(e.id))||!1,allNodes:I,board:j,onAddEdge:E,onDeleteEdge:w},e.id))})}),(0,n.jsx)("div",{style:Y.footer,children:o?(0,n.jsxs)("form",{onSubmit:a,style:Y.addNodeForm,children:[(0,n.jsx)("input",{type:"text",value:r,onChange:e=>d(e.target.value),placeholder:"Enter node title...",autoFocus:!0,style:Y.addNodeInput}),(0,n.jsxs)("div",{style:Y.addNodeActions,children:[(0,n.jsx)("button",{type:"submit",style:{...Y.addButton,..."add"===s?Y.addButtonHover:{}},onMouseEnter:()=>c("add"),onMouseLeave:()=>c(null),children:"Add"}),(0,n.jsx)("button",{type:"button",onClick:()=>{i(!1),d("")},style:{...Y.cancelButton,..."cancel"===s?Y.cancelButtonHover:{}},onMouseEnter:()=>c("cancel"),onMouseLeave:()=>c(null),children:"Cancel"})]})]}):(0,n.jsx)("button",{style:{...Y.addNodeButton,..."addNode"===s?Y.addNodeButtonHover:{}},onClick:()=>i(!0),onMouseEnter:()=>c("addNode"),onMouseLeave:()=>c(null),children:"+ Add Node"})})]})}var q=o(6251);let X={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)"},container:{position:"fixed",inset:0,zIndex:10,overflow:"auto"},wrapper:{display:"flex",minHeight:"100%",alignItems:"center",justifyContent:"center",padding:"1rem"},modal:{backgroundColor:"#ffffff",borderRadius:I,boxShadow:"0 10px 25px rgba(0, 0, 0, 0.2)",padding:m,minWidth:"320px",maxWidth:"400px",position:"relative"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:h,paddingBottom:b,borderBottom:"1px solid ".concat(s[200])},title:{fontSize:C,fontWeight:"600",color:s[900],margin:0},closeButton:{background:"none",border:"none",color:s[400],cursor:"pointer",padding:x,borderRadius:S,transition:"all 0.2s ease",fontSize:"18px",display:"flex",alignItems:"center",justifyContent:"center"},closeButtonHover:{backgroundColor:s[100],color:s[700]},content:{display:"flex",flexDirection:"column",gap:h},colorPickerSection:{display:"flex",flexDirection:"column",gap:b},colorPickerLabel:{fontSize:y,color:s[700],fontWeight:"500"},colorPicker:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:b,padding:b,backgroundColor:s[50],borderRadius:k},colorOption:{width:"40px",height:"40px",borderRadius:"50%",border:"3px solid transparent",cursor:"pointer",transition:"all 0.2s ease",position:"relative"},colorOptionActive:{border:"3px solid #ffffff",boxShadow:"0 0 0 3px #3b82f6",transform:"scale(1.1)"},colorOptionHover:{transform:"scale(1.05)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)"},section:{display:"flex",flexDirection:"column",gap:x},label:{fontSize:y,color:s[700],fontWeight:"500"},textInput:{padding:b,border:"1px solid ".concat(s[300]),borderRadius:k,fontSize:y,outline:"none",transition:"border-color 0.2s ease"},select:{padding:b,border:"1px solid ".concat(s[300]),borderRadius:k,fontSize:y,outline:"none",backgroundColor:"white",cursor:"pointer"},helperText:{fontSize:v,color:s[500],marginTop:x},actions:{display:"flex",gap:b,marginTop:h,flexWrap:"wrap"},saveButton:{padding:"".concat(b," ").concat(h),backgroundColor:c[600],color:"white",border:"none",borderRadius:k,fontSize:y,fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},saveButtonHover:{backgroundColor:c[700]},deleteButton:{padding:"".concat(b," ").concat(h),backgroundColor:g[600],color:"white",border:"none",borderRadius:k,fontSize:y,fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},deleteButtonHover:{backgroundColor:g[700]},cancelButton:{padding:"".concat(b," ").concat(h),backgroundColor:s[200],color:s[700],border:"none",borderRadius:k,fontSize:y,fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},cancelButtonHover:{backgroundColor:s[300]}};function Q(e){let{isModalOpen:t,setIsModalOpen:o,list:r,colors:l,handleColorChange:d,onUpdateList:a,onDeleteList:s,hoveredButton:c,setHoveredButton:u,hoveredColor:p,setHoveredColor:g}=e,[f,x]=(0,i.useState)((null==r?void 0:r.name)||"");return i.useEffect(()=>{t&&r&&x(r.name)},[t,r]),(0,n.jsx)(q.u,{show:t,children:(0,n.jsxs)(U.Vq,{as:"div",className:"fixed inset-0 z-10 overflow-y-auto",onClose:()=>o(!1),children:[(0,n.jsx)("div",{className:"fixed inset-0 bg-black/25",style:X.overlay}),(0,n.jsx)("div",{style:X.container,children:(0,n.jsx)("div",{style:X.wrapper,children:(0,n.jsxs)(U.EM,{style:X.modal,children:[(0,n.jsxs)("div",{style:X.header,children:[(0,n.jsx)(U.$N,{as:"h3",style:X.title,children:"List Settings"}),(0,n.jsx)("button",{style:{...X.closeButton,..."close"===c?X.closeButtonHover:{}},onClick:()=>o(!1),onMouseEnter:()=>u("close"),onMouseLeave:()=>u(null),title:"Close",children:"✕"})]}),(0,n.jsxs)("div",{style:X.content,children:[(0,n.jsxs)("div",{style:X.section,children:[(0,n.jsx)("label",{style:X.label,children:"List Name"}),(0,n.jsx)("input",{type:"text",value:f,onChange:e=>x(e.target.value),style:X.textInput,placeholder:"Enter list name..."})]}),(0,n.jsxs)("div",{style:X.section,children:[(0,n.jsx)("label",{style:X.label,children:"List Color"}),(0,n.jsx)("div",{style:X.colorPicker,children:l.map(e=>(0,n.jsx)("button",{style:{...X.colorOption,backgroundColor:e,...r.color===e?X.colorOptionActive:{},...p===e?X.colorOptionHover:{}},onClick:()=>d(e),onMouseEnter:()=>g(e),onMouseLeave:()=>g(null),title:"Change to ".concat(e)},e))})]}),(0,n.jsxs)("div",{style:X.actions,children:[(0,n.jsx)("button",{style:{...X.saveButton,..."save"===c?X.saveButtonHover:{}},onClick:()=>{f.trim()&&a&&a(r.id,{name:f.trim()}),o(!1)},onMouseEnter:()=>u("save"),onMouseLeave:()=>u(null),children:"Save Changes"}),(null==r?void 0:r.type)===w&&(0,n.jsx)("button",{style:{...X.deleteButton,..."deleteList"===c?X.deleteButtonHover:{}},onClick:()=>{if(r.type!==w){alert("Only intermediate outcome lists can be deleted.");return}confirm('Delete "'.concat(r.name,'" and all its nodes?'))&&(s(r.id),o(!1))},onMouseEnter:()=>u("deleteList"),onMouseLeave:()=>u(null),children:"Delete List"}),(0,n.jsx)("button",{style:{...X.cancelButton,..."cancel"===c?X.cancelButtonHover:{}},onClick:()=>o(!1),onMouseEnter:()=>u("cancel"),onMouseLeave:()=>u(null),children:"Cancel"})]})]})]})})})]})})}let G={backgroundColor:"#ffffff",borderRadius:I,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",minHeight:"400px",display:"flex",flexDirection:"column",minWidth:"300px",maxWidth:"300px"};function K(e){let{list:t,nodes:o,onUpdateList:r,onDeleteList:a,onAddNode:s,onUpdateNode:c,onDeleteNode:u,onDuplicateNode:p,onNodeClick:g,linkMode:f,linkSource:x,getConnectedNodes:b,draggableNodes:h,onToggleNodeDraggable:m,onStartLinking:v,onShowCausalPath:y,causalPathMode:C,causalPathNodes:S,allNodes:k,board:I,onAddEdge:j,onDeleteEdge:E}=e,[w,T]=(0,i.useState)(null),[M,L]=(0,i.useState)(!1),[B,O]=(0,i.useState)(t.name),[N,z]=(0,i.useState)(!1),[R,H]=(0,i.useState)(""),[W,P]=(0,i.useState)(!1),[U,_]=(0,i.useState)(null);(0,i.useEffect)(()=>{let e=e=>"Escape"===e.key&&P(!1);return W&&window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[W]),(0,i.useEffect)(()=>{console.log("Modal state changed:",W)},[W]);let{attributes:F,listeners:Y,setNodeRef:q,transform:X,transition:K,isDragging:$}=(0,l.nB)({id:t.id,data:{type:"list",listId:t.id}}),J={...G,transform:d.ux.Transform.toString(X),transition:K,opacity:$?.5:1};return(0,n.jsxs)("div",{ref:q,style:J,"data-type":t.type,...F,children:[(0,n.jsx)(A,{list:t,nodesCount:o.length,isEditingTitle:M,editTitle:B,setIsEditingTitle:L,setEditTitle:O,handleTitleEdit:e=>{e.preventDefault(),B.trim()&&B!==t.name&&r(t.id,{name:B}),L(!1)},hoveredButton:w,setHoveredButton:T,listeners:Y,attributes:F,onSettingsClick:e=>{console.log("Settings button clicked!"),e.stopPropagation(),P(!0)},onDeleteList:a,isDragging:$}),(0,n.jsx)(V,{nodes:o,isAddingNode:N,setIsAddingNode:z,newNodeTitle:R,setNewNodeTitle:H,handleAddNode:e=>{if(e.preventDefault(),!R.trim())return;let o=D.ACTIVITY,n=t.name.toLowerCase();n.includes("output")?o=D.OUTPUT:n.includes("outcome")?o=D.INTERMEDIATE_OUTCOME:n.includes("final")?o=D.FINAL_OUTCOME:n.includes("impact")&&(o=D.IMPACT),s(R,o),H(""),z(!1)},hoveredButton:w,setHoveredButton:T,onUpdateNode:c,onDeleteNode:u,onDuplicateNode:p,onNodeClick:g,linkMode:f,linkSource:x,getConnectedNodes:b,draggableNodes:h,onToggleNodeDraggable:m,onStartLinking:v,onShowCausalPath:y,causalPathMode:C,causalPathNodes:S,allNodes:k,board:I,onAddEdge:j,onDeleteEdge:E}),"      ",(0,n.jsx)(Q,{isModalOpen:W,setIsModalOpen:P,list:t,colors:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#6b7280"],handleColorChange:e=>r(t.id,{color:e}),onUpdateList:r,onDeleteList:a,hoveredButton:w,setHoveredButton:T,hoveredColor:U,setHoveredColor:_})]})}function $(e){let{board:t,linkMode:o,causalPathMode:r,onStartLinkMode:l,onExitLinkMode:d,onExitCausalPathMode:a,onAddIntermediateOutcome:s}=e,[c,u]=(0,i.useState)(!1),[p,g]=(0,i.useState)(null);(0,i.useEffect)(()=>{u(!0)},[]);let f=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o={...z.button};return t?{...o,...z.buttonHover}:p===e?"secondary"===e?{...o,...z.buttonSecondary,...z.buttonSecondaryHover}:{...o,...z.buttonHover}:"secondary"===e?{...o,...z.buttonSecondary}:o};return c?(0,n.jsxs)("div",{style:z.container,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{style:z.title,children:t.name}),(0,n.jsxs)("span",{style:{fontSize:"0.875rem",color:"#6b7280"},children:[t.lists.length," lists • ",t.nodes.length," nodes • ",t.edges.length," connections",t.lists.filter(e=>"intermediate"===e.type).length>1&&(0,n.jsxs)("span",{children:["• ",t.lists.filter(e=>"intermediate"===e.type).length," intermediate stages"]})]})]}),(0,n.jsx)("div",{style:z.actions,children:(0,n.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[r?(0,n.jsx)("button",{style:f("danger"),onClick:a,onMouseEnter:()=>g("exitCausal"),onMouseLeave:()=>g(null),title:"Exit causal path mode",children:"Exit Causal Path Mode"}):(0,n.jsx)(n.Fragment,{}),o?(0,n.jsx)("button",{style:f("danger"),onClick:d,onMouseEnter:()=>g("exitLink"),onMouseLeave:()=>g(null),title:"Exit link mode",children:"Exit Link Mode"}):(0,n.jsx)("button",{style:f("link"),onClick:l,onMouseEnter:()=>g("link"),onMouseLeave:()=>g(null),title:"Start connecting nodes",children:"Connect Nodes"}),(0,n.jsx)("button",{style:f("intermediate"),onClick:s,onMouseEnter:()=>g("intermediate"),onMouseLeave:()=>g(null),title:"Add intermediate outcome stage",children:"+ Add Intermediate Outcome"})]})})]}):(0,n.jsxs)("div",{style:z.container,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{style:z.title,children:"Theory of Change Board"}),(0,n.jsx)("span",{children:"Loading..."})]}),(0,n.jsx)("div",{style:z.actions,children:(0,n.jsx)("button",{style:z.button,disabled:!0,children:"Loading..."})})]})}var J=o(6785),Z=o(8299);function ee(e){let{isOpen:t,onClose:o,onSave:r,onDelete:l,initialLabel:d="",initialType:a="LEADS_TO"}=e,[s,c]=(0,i.useState)(d),[u,p]=(0,i.useState)(a);return(0,i.useEffect)(()=>{c(d),p(a)},[d,a,t]),(0,n.jsxs)(U.Vq,{open:t,onClose:o,style:{position:"relative",zIndex:1e3},children:[(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)"},"aria-hidden":"true"}),(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:(0,n.jsxs)(U.EM,{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",minWidth:"400px",maxWidth:"500px"},children:[(0,n.jsx)(U.$N,{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Edit Connection"}),(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsx)("label",{htmlFor:"edge-label",style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Label (optional)"}),(0,n.jsx)("input",{id:"edge-label",type:"text",value:s,onChange:e=>c(e.target.value),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",outline:"none",boxSizing:"border-box"},placeholder:"Enter connection label..."})]}),(0,n.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,n.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"12px"},children:"Connection Type"}),(0,n.jsx)(Z.Ee,{value:u,onChange:p,style:{display:"flex",flexDirection:"column",gap:"8px"},children:[{value:"LEADS_TO",label:"Leads to",color:"#374151",style:"solid"},{value:"ENABLES",label:"Enables",color:"#10b981",style:"dashed"},{value:"REQUIRES",label:"Requires",color:"#ef4444",style:"dotted"},{value:"CONTRIBUTES_TO",label:"Contributes to",color:"#f59e0b",style:"solid"}].map(e=>(0,n.jsx)(Z.Y8,{value:e.value,style:{display:"flex",alignItems:"center",padding:"12px",border:"2px solid ".concat(u===e.value?"#3b82f6":"#e5e7eb"),borderRadius:"6px",cursor:"pointer",backgroundColor:u===e.value?"#eff6ff":"white"},children:t=>{let{checked:o}=t;return(0,n.jsxs)("div",{style:{display:"flex",width:"100%",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,n.jsx)("div",{style:{marginRight:"12px"},children:(0,n.jsx)("div",{style:{width:"16px",height:"16px",borderRadius:"50%",border:"2px solid ".concat(o?"#3b82f6":"#d1d5db"),backgroundColor:o?"#3b82f6":"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:o&&(0,n.jsx)("div",{style:{width:"6px",height:"6px",backgroundColor:"white",borderRadius:"50%"}})})}),(0,n.jsx)("div",{style:{fontSize:"14px",fontWeight:"500"},children:e.label})]}),(0,n.jsx)("div",{children:(0,n.jsxs)("svg",{width:"60",height:"20",children:[(0,n.jsx)("line",{x1:"5",y1:"10",x2:"45",y2:"10",stroke:e.color,strokeWidth:"2",strokeDasharray:"dashed"===e.style?"5,5":"dotted"===e.style?"2,3":"none"}),(0,n.jsx)("polygon",{points:"45,7 55,10 45,13",fill:e.color})]})})]})}},e.value))})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"16px",borderTop:"1px solid #e5e7eb"},children:[(0,n.jsx)("button",{onClick:()=>{confirm("Are you sure you want to delete this connection?")&&(l&&l(),o())},style:{padding:"8px 16px",fontSize:"14px",fontWeight:"500",color:"white",backgroundColor:"#ef4444",border:"none",borderRadius:"6px",cursor:"pointer"},onMouseEnter:e=>{e.target.style.backgroundColor="#dc2626"},onMouseLeave:e=>{e.target.style.backgroundColor="#ef4444"},children:"Delete Connection"}),(0,n.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,n.jsx)("button",{onClick:()=>{c(d),p(a),o()},style:{padding:"8px 16px",fontSize:"14px",fontWeight:"500",color:"#374151",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",cursor:"pointer"},children:"Cancel"}),(0,n.jsx)("button",{onClick:()=>{r({label:s.trim()||null,type:u}),o()},style:{padding:"8px 16px",fontSize:"14px",fontWeight:"500",color:"white",backgroundColor:"#3b82f6",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Save Changes"})]})]})]})})]})}o(715);let et={tocEdge:function(e){let t,{id:o,source:i,target:r,data:l}=e,d=(null==l?void 0:l.color)||"#374151",a=(null==l?void 0:l.type)||"LEADS_TO",s=(null==l?void 0:l.sourceX)||0,c=(null==l?void 0:l.sourceY)||0,u=(null==l?void 0:l.targetX)||0,p=(null==l?void 0:l.targetY)||0;if(0===s||0===u)return null;let g=u-s,f=Math.max(20,.3*Math.abs(g));if(g>0){let e=s+f;t="M ".concat(s," ").concat(c," \n            L ").concat(e," ").concat(c," \n            L ").concat(e," ").concat(p," \n            L ").concat(u," ").concat(p)}else{let e=Math.min(c,p)-30,o=s+f,n=u-f;t="M ".concat(s," ").concat(c," \n            L ").concat(o," ").concat(c," \n            L ").concat(o," ").concat(e," \n            L ").concat(n," ").concat(e,"\n            L ").concat(n," ").concat(p,"\n            L ").concat(u," ").concat(p)}return(0,n.jsxs)("g",{style:{pointerEvents:"auto"},children:[(0,n.jsx)("defs",{children:(0,n.jsx)("marker",{id:"arrowhead-".concat(o),markerWidth:"8",markerHeight:"6",refX:"7",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:(0,n.jsx)("polygon",{points:"0 0, 8 3, 0 6",fill:d,stroke:d,opacity:"0.8"})})}),(0,n.jsx)("path",{d:t,stroke:d,strokeWidth:2,strokeDasharray:(e=>{switch(e){case"ENABLES":return"8,4";case"REQUIRES":return"4,4";default:return"none"}})(a),fill:"none",markerEnd:"url(#arrowhead-".concat(o,")"),style:{opacity:.8,transition:"all 0.2s ease",pointerEvents:"stroke",cursor:"pointer"},onClick:e=>{e.stopPropagation(),console.log("Edge clicked!",{id:o,data:l}),(null==l?void 0:l.onEdit)?(console.log("Calling onEdit with:",{id:o,label:(null==l?void 0:l.label)||"",type:(null==l?void 0:l.type)||"LEADS_TO"}),l.onEdit({id:o,label:(null==l?void 0:l.label)||"",type:(null==l?void 0:l.type)||"LEADS_TO"})):console.log("No onEdit function found in data:",l)},onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),confirm("Delete this connection?")&&(null==l?void 0:l.onDelete)&&l.onDelete(o)},onMouseEnter:e=>{e.target.style.opacity="1",e.target.style.strokeWidth="3"},onMouseLeave:e=>{e.target.style.opacity="0.8",e.target.style.strokeWidth="2"}}),(0,n.jsx)("path",{d:t,stroke:"transparent",strokeWidth:"16",fill:"none",style:{cursor:"pointer",pointerEvents:"stroke"},onClick:e=>{e.stopPropagation(),console.log("Invisible edge area clicked!",{id:o,data:l}),(null==l?void 0:l.onEdit)?(console.log("Calling onEdit from invisible area with:",{id:o,label:(null==l?void 0:l.label)||"",type:(null==l?void 0:l.type)||"LEADS_TO"}),l.onEdit({id:o,label:(null==l?void 0:l.label)||"",type:(null==l?void 0:l.type)||"LEADS_TO"})):console.log("No onEdit function found in invisible area data:",l)},onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),confirm("Delete this connection?")&&(null==l?void 0:l.onDelete)&&l.onDelete(o)}})]})}};function eo(e){let{edges:t,nodes:o,onUpdateEdge:r,onDeleteEdge:l}=e,{project:d,getViewport:a}=(0,J._K)(),[s,c]=(0,J.Rr)([]),[u,p]=(0,J.ll)([]),g=(0,i.useRef)(null),[f,x]=(0,i.useState)(null),b=(0,i.useCallback)(e=>{console.log("setEditingEdge called with:",e),x(e)},[]),h=(0,i.useCallback)(e=>{console.log("handleSaveEdge called with:",e),r&&f&&r(f.id,{label:e.label,type:e.type}),b(null)},[r,f,b]),m=(0,i.useCallback)(()=>{console.log("handleCancelEdit called"),b(null)},[b]),v=(0,i.useCallback)(()=>{console.log("handleDeleteEdge called for edge:",null==f?void 0:f.id),l&&f&&l(f.id),b(null)},[l,f,b]),y=(0,i.useCallback)(e=>{let t=document.querySelector('[data-node-id="'.concat(e,'"]'));if(!t||!g.current)return{x:0,y:0,width:0,height:0};let o=g.current.parentElement;if(!o)return{x:0,y:0,width:0,height:0};let n=t.getBoundingClientRect(),i=o.getBoundingClientRect();return{x:n.left-i.left+o.scrollLeft,y:n.top-i.top+o.scrollTop,width:n.width,height:n.height}},[]),C=(0,i.useCallback)((e,t)=>{let o=y(e),n=y(t);if(!o||!n||0===o.width||0===n.width)return{sourceX:0,sourceY:0,targetX:0,targetY:0};let i=o.x+o.width;return{sourceX:i,sourceY:o.y+o.height/2,targetX:n.x,targetY:n.y+n.height/2}},[y]),S=(0,i.useCallback)(()=>o.map(e=>{let t=y(e.id);return{id:e.id,position:{x:t.x,y:t.y},data:{label:""},style:{width:t.width,height:t.height,opacity:0,pointerEvents:"none"},draggable:!1,connectable:!1,selectable:!1}}),[o,y]),k=(0,i.useCallback)(()=>t.map(e=>{let{sourceX:t,sourceY:o,targetX:n,targetY:i}=C(e.sourceId,e.targetId);return{id:e.id,source:e.sourceId,target:e.targetId,type:"tocEdge",sourceHandle:"right",targetHandle:"left",data:{type:e.type,label:e.label,color:I(e.type),onUpdate:r,onDelete:l,onEdit:b,sourceX:t,sourceY:o,targetX:n,targetY:i},style:{stroke:I(e.type)}}}),[t,r,l,b,C]),I=e=>{switch(e){case"LEADS_TO":default:return"#374151";case"ENABLES":return"#10b981";case"REQUIRES":return"#ef4444";case"CONTRIBUTES_TO":return"#f59e0b"}};return(0,i.useEffect)(()=>{let e=setTimeout(()=>{c(S()),p(k())},100);return()=>{clearTimeout(e)}},[o,t,S,k]),(0,i.useEffect)(()=>{let e=()=>{let e=setTimeout(()=>{c(S()),p(k())},100);return()=>clearTimeout(e)};return window.addEventListener("resize",e,{passive:!0}),()=>{window.removeEventListener("resize",e)}},[S,k]),(0,n.jsxs)("div",{ref:g,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1,overflow:"visible"},children:[(0,n.jsx)(J.x$,{nodes:s,edges:u,edgeTypes:et,nodesDraggable:!1,nodesConnectable:!1,elementsSelectable:!1,zoomOnScroll:!1,zoomOnPinch:!1,panOnScroll:!1,panOnDrag:!1,zoomOnDoubleClick:!1,preventScrolling:!1,style:{pointerEvents:"none",width:"100%",height:"100%"},fitView:!1,attributionPosition:"bottom-left",proOptions:{hideAttribution:!0}}),f&&(0,n.jsx)(ee,{isOpen:!!f,onClose:m,onSave:h,onDelete:v,initialLabel:f.label||"",initialType:f.type||"LEADS_TO"})]})}function en(e){let{edges:t,nodes:o,onUpdateEdge:i,onDeleteEdge:r}=e;return(console.log("TocEdges rendered with:",{edges:null==t?void 0:t.length,nodes:null==o?void 0:o.length}),t&&0!==t.length)?(0,n.jsx)(J.tV,{children:(0,n.jsx)(eo,{edges:t,nodes:o,onUpdateEdge:i,onDeleteEdge:r})}):(console.log("No edges to render"),null)}function ei(e){let{visible:t=!0}=e;return t?(0,n.jsxs)("div",{style:{position:"fixed",bottom:"20px",right:"20px",background:"white",padding:"12px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",fontSize:"12px",zIndex:100,border:"1px solid #e5e7eb",minWidth:"140px"},children:[(0,n.jsx)("h4",{style:{margin:"0 0 8px 0",fontSize:"14px",fontWeight:"600",color:"#374151"},children:"Connection Types"}),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,n.jsx)("div",{style:{width:"20px",height:"2px",backgroundColor:"#374151",position:"relative"},children:(0,n.jsx)("div",{style:{position:"absolute",right:"-4px",top:"-2px",width:0,height:0,borderLeft:"4px solid #374151",borderTop:"3px solid transparent",borderBottom:"3px solid transparent",opacity:.7}})}),(0,n.jsx)("span",{style:{color:"#6b7280",fontSize:"11px"},children:"Leads to"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,n.jsx)("div",{style:{width:"20px",height:"2px",backgroundColor:"#10b981",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 4px, white 4px, white 8px)",position:"relative"},children:(0,n.jsx)("div",{style:{position:"absolute",right:"-4px",top:"-2px",width:0,height:0,borderLeft:"4px solid #10b981",borderTop:"3px solid transparent",borderBottom:"3px solid transparent",opacity:.7}})}),(0,n.jsx)("span",{style:{color:"#6b7280",fontSize:"11px"},children:"Enables"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,n.jsx)("div",{style:{width:"20px",height:"2px",backgroundColor:"#ef4444",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 2px, white 2px, white 4px)",position:"relative"},children:(0,n.jsx)("div",{style:{position:"absolute",right:"-4px",top:"-2px",width:0,height:0,borderLeft:"4px solid #ef4444",borderTop:"3px solid transparent",borderBottom:"3px solid transparent",opacity:.7}})}),(0,n.jsx)("span",{style:{color:"#6b7280",fontSize:"11px"},children:"Requires"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,n.jsx)("div",{style:{width:"20px",height:"2px",backgroundColor:"#f59e0b",position:"relative"},children:(0,n.jsx)("div",{style:{position:"absolute",right:"-4px",top:"-2px",width:0,height:0,borderLeft:"4px solid #f59e0b",borderTop:"3px solid transparent",borderBottom:"3px solid transparent",opacity:.7}})}),(0,n.jsx)("span",{style:{color:"#6b7280",fontSize:"11px"},children:"Contributes to"})]})]})]}):null}let er={container:{height:"100vh",backgroundColor:s[50],background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",display:"flex",flexDirection:"column"},content:{flex:1,display:"flex",overflow:"hidden"},boardInner:{position:"relative",display:"flex",gap:m,margin:h,minHeight:"100%",alignItems:"flex-start",overflow:"auto"},listsContainer:{display:"flex",gap:"20px",padding:"20px",minHeight:"100vh",overflow:"auto"},dragOverlay:{opacity:.8,transform:"rotate(5deg)",zIndex:1e3}};function el(e){var t,o,d,a;let{boardId:s="default"}=e,[c,u]=(0,i.useState)(),[p,g]=(0,i.useState)(!1),[f,x]=(0,i.useState)(null),[b,h]=(0,i.useState)(null),[m,v]=(0,i.useState)(null),[y,C]=(0,i.useState)(new Set),[S,k]=(0,i.useState)(!1),[I,j]=(0,i.useState)(new Set),{addIntermediateOutcome:w,updateList:M,deleteList:A,reorderLists:N}=function(e,t){let o=(0,i.useCallback)(function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!(null==e?void 0:e.lists))return;let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#6b7280",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"intermediate";return{id:O(),name:e,color:t,order:o,type:n,collapsed:!1,nodeIds:[]}}(o||"Intermediate Outcomes ".concat(e.lists.filter(e=>"intermediate"===e.type).length+1),"#f59e0b",0,"intermediate");return t(e=>{if(!(null==e?void 0:e.lists))return e;let t=[...e.lists],o=t.findIndex(e=>"Final Outcomes"===e.name||"fixed"===e.type&&e.order>=3),i=-1!==o?o:t.length-2;return t.splice(i,0,n),t.forEach((e,t)=>{e.order=t}),{...e,lists:t,updatedAt:new Date().toISOString()}}),n.id},[null==e?void 0:e.lists,t]);return{addIntermediateOutcome:o,updateList:(0,i.useCallback)((e,o)=>{t(t=>(null==t?void 0:t.lists)?{...t,lists:t.lists.map(t=>t.id===e?{...t,...o}:t),updatedAt:new Date().toISOString()}:t)},[t]),deleteList:(0,i.useCallback)(e=>{t(t=>{if(!(null==t?void 0:t.lists)||!(null==t?void 0:t.nodes)||!(null==t?void 0:t.edges))return t;let o=t.lists.find(t=>t.id===e);if(o&&"fixed"===o.type)return alert("Cannot delete core Theory of Change stages."),t;let n=t.nodes.filter(t=>t.listId===e).map(e=>e.id),i=t.lists.filter(t=>t.id!==e);return i.forEach((e,t)=>{e.order=t}),{...t,lists:i,nodes:t.nodes.filter(t=>t.listId!==e),edges:t.edges.filter(e=>!n.includes(e.sourceId)&&!n.includes(e.targetId)),updatedAt:new Date().toISOString()}})},[t]),reorderLists:(0,i.useCallback)((e,o)=>{t(t=>{if(!(null==t?void 0:t.lists))return t;let n=[...t.lists],i=n.findIndex(t=>t.id===e),r=n.findIndex(e=>e.id===o);if(-1===i||-1===r)return t;let[l]=n.splice(i,1);return n.splice(r,0,l),n.forEach((e,t)=>{e.order=t}),{...t,lists:n,updatedAt:new Date().toISOString()}})},[t])}}(c,u),{addNode:z,updateNode:R,deleteNode:H,reorderNodes:W,moveNode:P,duplicateNode:U}=function(e,t){let o=(0,i.useCallback)(function(e,o){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.ACTIVITY;t(t=>{if(!t)return t;let i=t.nodes.filter(e=>e.listId===o),r=i.length>0?Math.max(...i.map(e=>e.order||0)):-1,l={...L(e,o,n),order:r+1};return{...t,nodes:[...t.nodes,l],updatedAt:new Date().toISOString()}})},[t]),n=(0,i.useCallback)((e,o)=>{t(t=>(null==t?void 0:t.nodes)?{...t,nodes:t.nodes.map(t=>t.id===e?{...t,...o,updatedAt:new Date().toISOString()}:t),updatedAt:new Date().toISOString()}:t)},[t]),r=(0,i.useCallback)(e=>{t(t=>(null==t?void 0:t.nodes)&&(null==t?void 0:t.edges)?{...t,nodes:t.nodes.filter(t=>t.id!==e),edges:t.edges.filter(t=>t.sourceId!==e&&t.targetId!==e),updatedAt:new Date().toISOString()}:t)},[t]);return{addNode:o,updateNode:n,deleteNode:r,reorderNodes:(0,i.useCallback)((e,o,n)=>{t(t=>{if(!(null==t?void 0:t.nodes))return t;let i=[...t.nodes],r=i.filter(e=>e.listId===n),l=i.filter(e=>e.listId!==n),d=r.findIndex(t=>t.id===e),a=r.findIndex(e=>e.id===o);if(-1===d||-1===a)return t;let[s]=r.splice(d,1);return r.splice(a,0,s),r.forEach((e,t)=>{e.order=t,e.updatedAt=new Date().toISOString()}),{...t,nodes:[...l,...r],updatedAt:new Date().toISOString()}})},[t]),moveNode:(0,i.useCallback)(function(e,o){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t(t=>{if(!(null==t?void 0:t.nodes))return t;let i=t.nodes.filter(e=>e.listId===o),r=i.length>0?Math.max(...i.map(e=>e.order||0)):-1;return{...t,nodes:t.nodes.map(t=>t.id===e?{...t,listId:o,order:null!==n?n:r+1,updatedAt:new Date().toISOString()}:t),updatedAt:new Date().toISOString()}})},[t]),duplicateNode:(0,i.useCallback)(o=>{let n=null==e?void 0:e.nodes.find(e=>e.id===o);if(!n)return null;let i={...L(n.title+" (Copy)",n.listId,n.type),description:n.description,tags:[...n.tags],color:n.color,priority:n.priority};return t(e=>({...e,nodes:[...e.nodes,i],updatedAt:new Date().toISOString()})),i.id},[null==e?void 0:e.nodes,t])}}(c,u),{addEdge:_,updateEdge:Y,deleteEdge:V}=(d=c,a=u,{addEdge:(0,i.useCallback)(function(e,t){var o;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.LEADS_TO,i=null==d?void 0:null===(o=d.edges)||void 0===o?void 0:o.find(o=>o.sourceId===e&&o.targetId===t);if(i)return i.id;let r=B(e,t,n);return a(e=>(null==e?void 0:e.edges)?{...e,edges:[...e.edges,r],updatedAt:new Date().toISOString()}:e),r.id},[null==d?void 0:d.edges,a]),updateEdge:(0,i.useCallback)((e,t)=>{a(o=>(null==o?void 0:o.edges)?{...o,edges:o.edges.map(o=>o.id===e?{...o,...t}:o),updatedAt:new Date().toISOString()}:o)},[a]),deleteEdge:(0,i.useCallback)(e=>{a(t=>(null==t?void 0:t.edges)?{...t,edges:t.edges.filter(t=>t.id!==e),updatedAt:new Date().toISOString()}:t)},[a])});(0,i.useEffect)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Theory of Change Board",t=O(),o=E.map(e=>({...e,id:e.id,nodeIds:[]})),n=[L("Community Training Workshops","activities",D.ACTIVITY),L("Teacher Professional Development","activities",D.ACTIVITY),L("Digital Learning Platform Development","activities",D.ACTIVITY),L("Curriculum Design and Review","activities",D.ACTIVITY),L("500 Teachers Trained","outputs",D.OUTPUT),L("Online Learning Platform Launched","outputs",D.OUTPUT),L("Updated Curriculum Materials","outputs",D.OUTPUT),L("Community Learning Centers Established","outputs",D.OUTPUT),L("Improved Teaching Quality","intermediate-1",D.INTERMEDIATE_OUTCOME),L("Increased Student Engagement","intermediate-1",D.INTERMEDIATE_OUTCOME),L("Enhanced Digital Literacy","intermediate-1",D.INTERMEDIATE_OUTCOME),L("Improved Student Learning Outcomes","final-outcomes",D.FINAL_OUTCOME),L("Reduced Educational Inequality","final-outcomes",D.FINAL_OUTCOME),L("Increased School Completion Rates","final-outcomes",D.FINAL_OUTCOME),L("Sustainable Community Development","impact",D.IMPACT),L("Reduced Poverty in Target Communities","impact",D.IMPACT)];n.forEach((e,t)=>{var o,i;let r=n.filter(t=>t.listId===e.listId).findIndex(t=>t.id===e.id);e.order=r,e.description=(e.title,i=e.type,({[D.ACTIVITY]:"Key activity to implement the program",[D.OUTPUT]:"Direct result of program activities",[D.INTERMEDIATE_OUTCOME]:"Medium-term change resulting from outputs",[D.FINAL_OUTCOME]:"Long-term change we aim to achieve",[D.IMPACT]:"Ultimate societal change we contribute to"})[i]||"Description for this node")});let i=[B(n[0].id,n[4].id,T.LEADS_TO),B(n[1].id,n[4].id,T.LEADS_TO),B(n[2].id,n[5].id,T.LEADS_TO),B(n[4].id,n[8].id,T.LEADS_TO),B(n[5].id,n[10].id,T.LEADS_TO),B(n[8].id,n[11].id,T.LEADS_TO),B(n[11].id,n[15].id,T.CONTRIBUTES_TO)];return{id:t,name:e,description:"A sample Theory of Change for education improvement",lists:o,nodes:n,edges:i,settings:{showLabels:!0,snapToGrid:!1,autoLayout:!0,theme:"light"},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}();console.log("Initial board created:",e),u(e)},[s]),(0,i.useCallback)(e=>{u(t=>({...t,...e,updatedAt:new Date().toISOString()}))},[]);let q=(0,i.useCallback)(()=>{g(!0),x(null)},[]),X=(0,i.useCallback)(()=>{g(!1),x(null)},[]),Q=(0,i.useCallback)(e=>{p&&(f?f!==e&&(_(f,e),x(null),g(!1)):x(e))},[p,f,_]),G=(0,i.useCallback)((e,t)=>{C(o=>{let n=new Set(o);return t?n.add(e):n.delete(e),n})},[]),J=(0,i.useCallback)(e=>{g(!0),x(e)},[]),Z=(0,i.useCallback)(e=>{if(!(null==c?void 0:c.nodes))return[];let t=c.nodes.filter(t=>t.listId===e).sort((e,t)=>(e.order||0)-(t.order||0));return S&&(t=t.filter(e=>I.has(e.id))),t},[null==c?void 0:c.nodes,S,I]),ee=(0,i.useCallback)(e=>{if(!(null==c?void 0:c.edges)||!(null==c?void 0:c.nodes))return[];let t=c.edges.filter(t=>t.sourceId===e||t.targetId===e).flatMap(e=>[e.sourceId,e.targetId]);return c.nodes.filter(e=>t.includes(e.id))},[null==c?void 0:c.edges,null==c?void 0:c.nodes]),et=(0,i.useCallback)(e=>{if(!(null==c?void 0:c.edges)||!(null==c?void 0:c.nodes))return new Set;let t=new Set,o=[e];for(;o.length>0;){let e=o.shift();t.has(e)||(t.add(e),c.edges.filter(t=>t.sourceId===e||t.targetId===e).forEach(n=>{let i=n.sourceId===e?n.targetId:n.sourceId;t.has(i)||o.push(i)}))}return t},[null==c?void 0:c.edges,null==c?void 0:c.nodes]),eo=(0,i.useCallback)(e=>{j(et(e)),k(!0)},[et]),el=(0,i.useCallback)(()=>{k(!1),j(new Set)},[]),ed=(0,i.useCallback)(()=>S&&0!==I.size?((null==c?void 0:c.edges)||[]).filter(e=>I.has(e.sourceId)&&I.has(e.targetId)):(null==c?void 0:c.edges)||[],[null==c?void 0:c.edges,S,I]);return c?(0,n.jsxs)("div",{style:er.container,onClick:e=>{e.target===e.currentTarget&&(clearSelection(),p&&X())},children:[(0,n.jsx)($,{board:c,linkMode:p,causalPathMode:S,onStartLinkMode:q,onExitLinkMode:X,onExitCausalPathMode:el,onAddIntermediateOutcome:()=>{let e=prompt("Enter intermediate outcome name:");e?w(e):""===e&&w()}}),(0,n.jsx)("div",{style:er.content,children:(0,n.jsxs)(r.LB,{collisionDetection:r.pE,onDragStart:e=>{var t;h(e.active.id),v((null===(t=e.active.data.current)||void 0===t?void 0:t.type)||"node")},onDragEnd:e=>{let{active:t,over:o}=e;if(!o){h(null),v(null);return}if("list"===m)t.id!==o.id&&N(t.id,o.id);else if("node"===m){var n,i;let e=null===(n=t.data.current)||void 0===n?void 0:n.listId,r=(null===(i=o.data.current)||void 0===i?void 0:i.listId)||o.id;e&&r&&(e===r?t.id!==o.id&&W(t.id,o.id,e):P(t.id,r)),C(e=>{let o=new Set(e);return o.delete(t.id),o})}h(null),v(null)},children:[(0,n.jsxs)("div",{style:er.boardInner,children:[(0,n.jsx)(l.Fo,{items:(null==c?void 0:null===(t=c.lists)||void 0===t?void 0:t.map(e=>e.id))||[],strategy:l.PG,children:((null==c?void 0:c.lists)||[]).sort((e,t)=>e.order-t.order).map(e=>(0,n.jsx)(K,{list:e,nodes:Z(e.id)||[],onUpdateList:M,onDeleteList:A,onAddNode:(t,o)=>z(t,e.id,o),onUpdateNode:R,onDeleteNode:H,onDuplicateNode:U,onNodeClick:Q,linkMode:p,linkSource:f,getConnectedNodes:ee,draggableNodes:y,onToggleNodeDraggable:G,onStartLinking:J,onShowCausalPath:eo,causalPathMode:S,causalPathNodes:I,allNodes:(null==c?void 0:c.nodes)||[],board:c,onAddEdge:_,onDeleteEdge:V},e.id))}),(0,n.jsx)(en,{edges:ed(),nodes:(null==c?void 0:c.nodes)||[],onUpdateEdge:Y,onDeleteEdge:V})]}),(0,n.jsx)(r.y9,{children:b&&"node"===m?(0,n.jsx)(F,{node:null==c?void 0:c.nodes.find(e=>e.id===b),isDragging:!0,linkMode:!1,isLinkSource:!1,allNodes:(null==c?void 0:c.nodes)||[],board:c}):null})]})}),(0,n.jsx)(ei,{visible:(null==c?void 0:null===(o=c.edges)||void 0===o?void 0:o.length)>0})]}):(0,n.jsx)("div",{style:{...er.container,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",color:"#6b7280"},children:"Loading Theory of Change Board..."})}function ed(e){let{children:t,fallback:o=null}=e,[n,r]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{r(!0)},[]),n)?t:o}function ea(){return(0,n.jsx)("div",{className:"app",children:(0,n.jsx)(ed,{fallback:(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"#f8fafc"},children:(0,n.jsxs)("div",{style:{textAlign:"center"},children:[(0,n.jsx)("div",{style:{width:"40px",height:"40px",border:"4px solid #e2e8f0",borderTop:"4px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 1rem"}}),(0,n.jsx)("p",{style:{color:"#6b7280",fontSize:"0.875rem"},children:"Loading Theory of Change Board..."})]})}),children:(0,n.jsx)(el,{})})})}}},function(e){e.O(0,[489,780,714,971,23,744],function(){return e(e.s=3585)}),_N_E=e.O()}]);